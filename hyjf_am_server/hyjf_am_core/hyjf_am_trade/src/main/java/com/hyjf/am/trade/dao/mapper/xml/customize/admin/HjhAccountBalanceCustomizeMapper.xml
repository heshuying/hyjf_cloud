<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
		namespace="com.hyjf.am.trade.dao.mapper.customize.admin.HjhAccountBalanceCustomizeMapper">
	<!--汇计划资本按天统计及预估表列表 -->
	<resultMap id="selectHjhAccountBalanceMap" type="com.hyjf.am.vo.admin.HjhAccountBalanceVO">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="rpt_date" property="rptDate" jdbcType="DATE" />
		<result column="invest_account" property="investAccount"
				jdbcType="DECIMAL" />
		<result column="credit_account" property="creditAccount"
				jdbcType="DECIMAL" />
		<result column="reinvest_account" property="reinvestAccount"
				jdbcType="DECIMAL" />
		<result column="add_account" property="addAccount" jdbcType="DECIMAL" />
		<result column="create_user" property="createUser" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="update_user" property="updateUser" jdbcType="INTEGER" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="del_flag" property="delFlag" jdbcType="TINYINT" />
	</resultMap>
	<select id="selectHjhAccountBalanceForActList" resultMap="selectHjhAccountBalanceMap"
			parameterType="java.util.Date">
		SELECT
		`rpt_date` `rptDate`,
		SUM(i_account) invest_account,
		SUM(c_account) credit_account,
		SUM(r_account) reinvest_account,
		SUM(a_account) add_account,
		flag flag
		FROM
		(
		SELECT
		DATE_FORMAT(
		FROM_UNIXTIME(bt.addtime),
		'%Y-%m-%d'
		) `rptDate`,
		SUM(bt.account) i_account,
		0 c_account,
		0 r_account,
		0 a_account,
		1 flag -- 原始
		FROM
		huiyingdai_borrow_tender bt
		WHERE
		bt.addtime BETWEEN UNIX_TIMESTAMP(#{date}) AND UNIX_TIMESTAMP(#{date}) + 86399
		AND bt.accede_order_id IS NOT NULL
		UNION ALL
		SELECT
		DATE_FORMAT(
		FROM_UNIXTIME(hdct.create_time),
		'%Y-%m-%d'
		) `rptDate`,
		0 i_account,
		SUM(hdct.assign_pay) c_account,
		0 r_account,
		0 a_account,
		2 flag -- 债转
		FROM
		hyjf_hjh_debt_credit_tender hdct
		WHERE
		hdct.create_time BETWEEN UNIX_TIMESTAMP(#{date}) AND UNIX_TIMESTAMP(#{date}) + 86399
		UNION ALL
		SELECT
		DATE_FORMAT(
		FROM_UNIXTIME(bt.addtime),
		'%Y-%m-%d'
		) `rptDate`,
		0 i_account,
		0 c_account,
		SUM(bt.account) r_account,
		0 a_account,
		3 flag -- 复投原始
		FROM
		huiyingdai_borrow_tender bt
		WHERE
		bt.addtime BETWEEN UNIX_TIMESTAMP(#{date}) AND UNIX_TIMESTAMP(#{date}) + 86399
		AND bt.tender_type = 1
		AND bt.accede_order_id IS NOT NULL
		UNION ALL
		SELECT
		DATE_FORMAT(
		FROM_UNIXTIME(hdct.create_time),
		'%Y-%m-%d'
		) `rptDate`,
		0 i_account,
		0 c_account,
		SUM(hdct.assign_pay) r_account,
		0 a_account,
		3 flag -- 复投债转
		FROM
		hyjf_hjh_debt_credit_tender hdct
		WHERE
		hdct.create_time BETWEEN UNIX_TIMESTAMP(#{date}) AND UNIX_TIMESTAMP(#{date}) + 86399
		AND hdct.tender_type = 1
		UNION ALL
		SELECT
		DATE_FORMAT(
		FROM_UNIXTIME(ha.add_time),
		'%Y-%m-%d'
		) `rptDate`,
		0 i_account,
		0 c_account,
		0 r_account,
		SUM(ha.accede_account) a_account,
		4 flag -- 加入计划
		FROM
		hyjf_hjh_accede ha
		WHERE
		ha.add_time BETWEEN UNIX_TIMESTAMP(#{date}) AND UNIX_TIMESTAMP(#{date}) + 86399
		) t
	</select>


	<resultMap id="RM_HjhAccountBalance"
			   type="com.hyjf.am.vo.admin.HjhAccountBalanceVO">
		<result property="id" column="id" />
		<result property="rptDate" column="rptDate" />
		<result property="investAccount" column="investAccount" />
		<result property="creditAccount" column="creditAccount" />
		<result property="reinvestAccount" column="reinvestAccount" />
		<result property="addAccount" column="addAccount" />
		<result property="createUser" column="createUser" />
		<result property="createTime" column="createTime" />
		<result property="updateUser" column="updateUser" />
		<result property="updateTime" column="updateTime" />
		<result property="delFlag" column="delFlag" />
		<result property="dataFormt" column="dataFormt" />
	</resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="HjhAccountBalance_columns">
		<![CDATA[
		id as id ,rpt_date as rptDate ,invest_account as investAccount,credit_account as creditAccount,
		reinvest_account as reinvestAccount,add_account as addAccount,create_user as createUser,
		create_time as createTime,update_user as updateUser,update_time as updateTime,del_flag as delFlag
	    ]]>
	</sql>

	<!-- mysql 分页尾 -->
	<sql id="pagination_Tail">
		<if test="limitStart >= 0">
			LIMIT #{limitStart} , #{limitEnd}
		</if>
	</sql>

	<sql id="HjhAccountBalance_findPage_where">
		<where>
			<if test="idSer != null and idSer != ''">
				AND HjhAccountBalance.id = #{idSer}
			</if>
			<if test="addTimeStart != null and addTimeStart != ''">
				AND HjhAccountBalance.rpt_date &gt;= DATE_FORMAT(#{addTimeStart},'%Y-%m-%d')
			</if>
			<if test="addTimeEnd != null and addTimeEnd != ''">
				AND HjhAccountBalance.rpt_date &lt;= DATE_FORMAT(#{addTimeEnd},'%Y-%m-%d')
			</if>
			<if test="investAccountSer != null and investAccountSer != ''">
				AND HjhAccountBalance.invest_account = #{investAccountSer}
			</if>
			<if test="creditAccountSer != null and creditAccountSer != ''">
				AND HjhAccountBalance.credit_account = #{creditAccountSer}
			</if>
			<if test="reinvestAccountSer != null and reinvestAccountSer != ''">
				AND HjhAccountBalance.reinvest_account = #{reinvestAccountSer}
			</if>
			<if test="addAccountSer != null and addAccountSer != ''">
				AND HjhAccountBalance.add_account = #{addAccountSer}
			</if>
			<if test="createUserSer != null and createUserSer != ''">
				AND HjhAccountBalance.create_user = #{createUserSer}
			</if>
			<if test="createTimeSer != null and createTimeSer != ''">
				AND HjhAccountBalance.create_time = #{createTimeSer}
			</if>
			<if test="updateUserSer != null and updateUserSer != ''">
				AND HjhAccountBalance.update_user = #{updateUserSer}
			</if>
			<if test="updateTimeSer != null and updateTimeSer != ''">
				AND HjhAccountBalance.update_time = #{updateTimeSer}
			</if>
			<if test="delFlgSer != null and delFlgSer != ''">
				AND HjhAccountBalance.del_flag = #{delFlgSer}
			</if>
		</where>
	</sql>

	<select id="getHjhAccountBalancecount" resultType="java.lang.Integer">
		SELECT count(*) FROM ht_hjh_account_balance HjhAccountBalance
		<include refid="HjhAccountBalance_findPage_where" />
	</select>

	<select id="getHjhAccountBalanceMonthCount" resultType="java.lang.Integer">
		select count(1) from (SELECT sum(invest_account) FROM
		ht_hjh_account_balance HjhAccountBalance group by
		DATE_FORMAT(rpt_date,'%Y-%m')) dddd;
	</select>
	<select id="getHjhAccountBalanceMonthCountNew" resultType="java.lang.Integer" parameterType="java.lang.String">
		select count(1) from (
		SELECT sum(invest_account)
		FROM ht_hjh_account_balance HjhAccountBalance
		where rpt_date &gt;= STR_TO_DATE(#{addTimeStart},"%Y-%m-%d")AND rpt_date &lt;= STR_TO_DATE(#{addTimeEnd},"%Y-%m-%d")
		group by DATE_FORMAT(rpt_date,'%Y-%m')
		) ffff
	</select>

	<select id="getHjhAccountBalanceList" resultMap="RM_HjhAccountBalance">
		SELECT <include refid="HjhAccountBalance_columns" /> FROM ht_hjh_account_balance
		HjhAccountBalance
		<include refid="HjhAccountBalance_findPage_where"/>
		<include refid="pagination_Tail"/>

	</select>

	<select id="getHjhAccountBalanceMonthList" resultMap="RM_HjhAccountBalance">
		select DATE_FORMAT(rpt_date,'%Y-%m')as dataFormt ,sum(invest_account) as
		'investAccount',sum(credit_account) as 'creditAccount'
		,sum(reinvest_account)as 'reinvestAccount',sum(add_account)as
		'addAccount'
		from ht_hjh_account_balance
		group by DATE_FORMAT(rpt_date,'%Y-%m')
		order by rpt_date desc
		<include refid="pagination_Tail" />
	</select>
	<select id="getHjhAccountBalanceMonthListNew" resultMap="RM_HjhAccountBalance" parameterType="java.lang.String">
		select DATE_FORMAT(rpt_date,'%Y-%m')as dataFormt ,sum(invest_account) as'investAccount',sum(credit_account) as 'creditAccount',sum(reinvest_account)as 'reinvestAccount',sum(add_account)as'addAccount'
		from ht_hjh_account_balance
		where rpt_date &gt;= STR_TO_DATE(#{addTimeStart},"%Y-%m-%d")AND rpt_date &lt;= STR_TO_DATE(#{addTimeEnd},"%Y-%m-%d")
		group by DATE_FORMAT(rpt_date,'%Y-%m')
		order by rpt_date desc
		<include refid="pagination_Tail" />
	</select>

	<select id="getHjhAccountBalanceSum" resultMap="RM_HjhAccountBalance">
		SELECT
		sum(invest_account) AS 'investAccount',
		sum(credit_account) AS 'creditAccount',
		sum(reinvest_account) AS 'reinvestAccount',
		sum(add_account) AS 'addAccount'
		FROM
		ht_hjh_account_balance HjhAccountBalance
		<include refid="HjhAccountBalance_findPage_where" />
		<include refid="pagination_Tail" />
	</select>
	<select id="getHjhAccountBalanceMonthSum" resultMap="RM_HjhAccountBalance">
		select
		sum(invest_account) as'investAccount',
		sum(credit_account) as 'creditAccount',
		sum(reinvest_account)as 'reinvestAccount',
		sum(add_account)as'addAccount'
		from ht_hjh_account_balance
		where rpt_date &gt;= STR_TO_DATE(#{addTimeStart},"%Y-%m-%d")AND rpt_date &lt;= STR_TO_DATE(#{addTimeEnd},"%Y-%m-%d")
		group by DATE_FORMAT(rpt_date,'%Y-%m')
		order by rpt_date desc
		<include refid="pagination_Tail" />
	</select>

</mapper>