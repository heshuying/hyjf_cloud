<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hyjf.am.trade.dao.mapper.customize.trade.CouponCustomizeMapper">

   <resultMap id="BaseResultMap" type="com.hyjf.am.trade.dao.model.customize.trade.CouponCustomize" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="coupon_code" property="couponCode" jdbcType="VARCHAR" />
        <result column="coupon_user_code" property="couponUserCode" jdbcType="VARCHAR" />
        <result column="coupon_type" property="couponType" jdbcType="INTEGER" />
        <result column="coupon_quota" property="couponQuota" jdbcType="DECIMAL" />
        <result column="coupon_system" property="couponSystem" jdbcType="INTEGER" />
        <result column="project_expiration_type" property="projectExpirationType" jdbcType="INTEGER" />
        <result column="project_expiration_length" property="projectExpirationLength" jdbcType="INTEGER" />
        <result column="project_expiration_length_min" property="projectExpirationLengthMin" jdbcType="INTEGER" />
        <result column="project_expiration_length_max" property="projectExpirationLengthMax" jdbcType="INTEGER" />
        <result column="project_type" property="projectType" jdbcType="VARCHAR" />
        <result column="tender_quota_type" property="tenderQuotaType" jdbcType="INTEGER" />
        <result column="tender_quota" property="tenderQuota" jdbcType="INTEGER" />
        <result column="tender_quota_min" property="tenderQuotaMin" jdbcType="INTEGER" />
        <result column="tender_quota_max" property="tenderQuotaMax" jdbcType="INTEGER" />
        <result column="end_time" property="endTime" jdbcType="INTEGER" />
        <result column="used_flag" property="usedFlag" jdbcType="INTEGER" />
        <result column="update_time" property="userUpdateTime" jdbcType="INTEGER" />
        <result column="add_flg" property="addFlg" jdbcType="INTEGER" />
        <result column="coupon_profit_time" property="couponProfitTime" jdbcType="INTEGER" />
        <result column="repay_time_config" property="repayTimeConfig" jdbcType="INTEGER" />
        <result column="coupon_profit_time" property="couponProfitTime" jdbcType="INTEGER" />
    </resultMap>

	<resultMap id="BorrowTenderCpnResultMap" type="com.hyjf.am.trade.dao.model.auto.BorrowTenderCpn" >
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="user_id" property="userId" jdbcType="INTEGER" />
		<result column="status" property="status" jdbcType="TINYINT" />
		<result column="borrow_nid" property="borrowNid" jdbcType="VARCHAR" />
		<result column="nid" property="nid" jdbcType="VARCHAR" />
		<result column="account_tender" property="accountTender" jdbcType="DECIMAL" />
		<result column="account" property="account" jdbcType="DECIMAL" />
		<result column="change_status" property="changeStatus" jdbcType="TINYINT" />
		<result column="change_userid" property="changeUserid" jdbcType="INTEGER" />
		<result column="change_period" property="changePeriod" jdbcType="INTEGER" />
		<result column="tender_status" property="tenderStatus" jdbcType="TINYINT" />
		<result column="tender_nid" property="tenderNid" jdbcType="VARCHAR" />
		<result column="tender_award_account" property="tenderAwardAccount" jdbcType="DECIMAL" />
		<result column="recover_full_status" property="recoverFullStatus" jdbcType="TINYINT" />
		<result column="recover_fee" property="recoverFee" jdbcType="DECIMAL" />
		<result column="recover_type" property="recoverType" jdbcType="VARCHAR" />
		<result column="recover_account_all" property="recoverAccountAll" jdbcType="DECIMAL" />
		<result column="recover_account_interest" property="recoverAccountInterest" jdbcType="DECIMAL" />
		<result column="recover_account_yes" property="recoverAccountYes" jdbcType="DECIMAL" />
		<result column="recover_account_interest_yes" property="recoverAccountInterestYes" jdbcType="DECIMAL" />
		<result column="recover_account_capital_yes" property="recoverAccountCapitalYes" jdbcType="DECIMAL" />
		<result column="recover_account_wait" property="recoverAccountWait" jdbcType="DECIMAL" />
		<result column="recover_account_interest_wait" property="recoverAccountInterestWait" jdbcType="DECIMAL" />
		<result column="recover_account_capital_wait" property="recoverAccountCapitalWait" jdbcType="DECIMAL" />
		<result column="recover_times" property="recoverTimes" jdbcType="INTEGER" />
		<result column="recover_advance_fee" property="recoverAdvanceFee" jdbcType="DECIMAL" />
		<result column="recover_late_fee" property="recoverLateFee" jdbcType="DECIMAL" />
		<result column="tender_award_fee" property="tenderAwardFee" jdbcType="DECIMAL" />
		<result column="loan_amount" property="loanAmount" jdbcType="DECIMAL" />
		<result column="loan_fee" property="loanFee" jdbcType="DECIMAL" />
		<result column="contents" property="contents" jdbcType="VARCHAR" />
		<result column="auto_status" property="autoStatus" jdbcType="TINYINT" />
		<result column="web_status" property="webStatus" jdbcType="TINYINT" />
		<result column="api_status" property="apiStatus" jdbcType="TINYINT" />
		<result column="add_ip" property="addIp" jdbcType="VARCHAR" />
		<result column="period_status" property="periodStatus" jdbcType="TINYINT" />
		<result column="isok" property="isok" jdbcType="TINYINT" />
		<result column="is_report" property="isReport" jdbcType="TINYINT" />
		<result column="flag" property="flag" jdbcType="TINYINT" />
		<result column="activity_flag" property="activityFlag" jdbcType="TINYINT" />
		<result column="client" property="client" jdbcType="TINYINT" />
		<result column="web" property="web" jdbcType="TINYINT" />
		<result column="invite_user_name" property="inviteUserName" jdbcType="VARCHAR" />
		<result column="invite_branch_id" property="inviteBranchId" jdbcType="INTEGER" />
		<result column="invite_branch_name" property="inviteBranchName" jdbcType="VARCHAR" />
		<result column="invite_department_id" property="inviteDepartmentId" jdbcType="INTEGER" />
		<result column="invite_department_name" property="inviteDepartmentName" jdbcType="VARCHAR" />
		<result column="tender_user_attribute" property="tenderUserAttribute" jdbcType="INTEGER" />
		<result column="invite_user_attribute" property="inviteUserAttribute" jdbcType="INTEGER" />
		<result column="order_date" property="orderDate" jdbcType="VARCHAR" />
		<result column="loan_ordid" property="loanOrdid" jdbcType="VARCHAR" />
		<result column="invite_user_id" property="inviteUserId" jdbcType="INTEGER" />
		<result column="invite_region_id" property="inviteRegionId" jdbcType="INTEGER" />
		<result column="invite_region_name" property="inviteRegionName" jdbcType="VARCHAR" />
		<result column="tender_user_name" property="tenderUserName" jdbcType="VARCHAR" />
		<result column="tender_type" property="tenderType" jdbcType="TINYINT" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
	</resultMap>


    <select id="getCouponUser" resultMap="BaseResultMap" parameterType="java.util.Map">
	    SELECT
			cc.coupon_code,
			cc.coupon_type,
			cc.coupon_system,
			cc.coupon_quota,
			cc.project_expiration_type,
			cc.project_expiration_length,
			cc.project_expiration_length_min,
			cc.project_expiration_length_max,
			cc.project_type,
			cc.tender_quota_type,
			cc.tender_quota,
			cc.tender_quota_min,
			cc.tender_quota_max,
			cu.coupon_user_code,
			cu.end_time,
			cu.used_flag,
			cu.update_time,
			cc.add_flg add_flg,
			cc.coupon_profit_time coupon_profit_time,
			cc.repay_time_config repayTimeConfig,
			cc.coupon_profit_time couponProfitTime
		FROM
			ht_coupon_user cu
		INNER JOIN ht_coupon_config cc ON cu.coupon_code = cc.coupon_code
		WHERE
			cu.id = #{couponGrantId}
		AND cu.user_id=#{userId}
		AND cu.del_flag = 0
		AND cc.del_flg = 0
	</select>

	<select id="getCouponTenderByTender" resultMap="BorrowTenderCpnResultMap" parameterType="java.util.Map">
		SELECT
			bt.*
		FROM
			ht_borrow_tender_cpn bt
		LEFT JOIN ht_coupon_real_tender crt ON crt.coupon_tender_id = bt.nid
		LEFT JOIN ht_coupon_tender ct ON bt.nid = ct.order_id
		WHERE
			bt.user_id = #{userId} AND bt.borrow_nid=#{borrowNid}  AND crt.real_tender_id=#{logOrdId} AND ct.coupon_grant_id=#{couponGrantId}
	</select>



</mapper>